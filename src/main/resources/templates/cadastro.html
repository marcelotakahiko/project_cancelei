<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Cadastro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2>Cadastro de Usuário</h2>
    <form th:action="@{/cadastro}" method="post" th:object="${usuario}">

        <div class="mb-3">
            <label for="nome" class="form-label">Nome ou Apelido</label>
            <input type="text" class="form-control" id="nome" th:field="*{nome}" required>
        </div>

        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email"
                   class="form-control"
                   id="email"
                   th:field="*{email}"
                   required>
            <div th:if="${#fields.hasErrors('email')}"
                 class="text-danger mt-1"
                 th:errors="*{email}">
            </div>
        </div>

        <div class="mb-3">
            <label for="senha" class="form-label">Senha</label>
            <input type="password" class="form-control" id="senha" th:field="*{senha}" required>
        </div>

        <div class="mb-3">
            <label for="confirmarSenha" class="form-label">Confirmar Senha</label>
            <input type="password" class="form-control" id="confirmarSenha" th:field="*{confirmarSenha}" required>
        </div>
        <div th:if="${#fields.hasErrors('confirmarSenha')}" class="text-danger mb-3">
            <p th:errors="*{confirmarSenha}"></p>
        </div>

        <div class="mb-3">
            <label for="cep" class="form-label">CEP</label>
            <input type="text" class="form-control" id="cep" th:field="*{cep}" maxlength="9">
        </div>
        <div class="mb-3">
            <label for="logradouro" class="form-label">Logradouro</label>
            <input type="text" class="form-control" id="logradouro" th:field="*{logradouro}">
        </div>
        <div class="mb-3">
            <label for="bairro" class="form-label">Bairro</label>
            <input type="text" class="form-control" id="bairro" th:field="*{bairro}">
        </div>
        <div class="mb-3">
            <label for="cidade" class="form-label">Cidade</label>
            <input type="text" class="form-control" id="cidade" th:field="*{cidade}">
        </div>
        <div class="mb-3">
            <label for="uf" class="form-label">UF</label>
            <input type="text" class="form-control" id="uf" th:field="*{uf}">
        </div>

        <!-- termos de aceitação -->
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox"
                   id="aceitouTermos" th:field="*{aceitouTermos}" required>
            <label class="form-check-label" for="aceitouTermos">
                Aceito os <a href="#" data-bs-toggle="modal" data-bs-target="#termosModal">
                Termos de Uso e Política de Privacidade
            </a>
            </label>
        </div>

        <button type="submit" class="btn btn-primary">Cadastrar</button>
    </form>
</div>

<div class="modal fade" id="termosModal" tabindex="-1" aria-labelledby="termosModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termosModalLabel">
                    Termos de Uso e Política de Privacidade do Cancelei!
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="max-height:60vh; overflow-y:auto;">
                <h5>1. Definições</h5>
                <ul>
                    <li><strong>Cancelei!:</strong> plataforma web para gestão de assinaturas e despesas recorrentes.</li>
                    <li><strong>Usuário:</strong> pessoa física que se cadastra e utiliza o sistema.</li>
                    <li><strong>Dados Pessoais:</strong> informações que identificam o Usuário (nome, email, CEP, endereço).</li>
                </ul>

                <h5>2. Escopo de Aplicação</h5>
                <p>Estes Termos regem o uso do Cancelei! e disciplinam o tratamento dos Dados Pessoais dos Usuários, conforme a Lei nº 13.709/2018 (LGPD).</p>

                <h5>3. Coleta de Dados</h5>
                <h6>3.1 Cadastro</h6>
                <p>nome, email e senha (criptografada) e endereço via CEP.</p>
                <h6>3.2 Uso da Plataforma</h6>
                <p>dados de assinaturas (serviço, valor, vencimento, forma de pagamento, status) e histórico de pagamentos (valor, data, método, status).</p>

                <h5>4. Finalidades do Tratamento</h5>
                <ul>
                    <li>Autenticação e segurança de acesso.</li>
                    <li>Gestão de assinaturas e notificações de vencimento.</li>
                    <li>Envio de alertas e lembretes por email.</li>
                    <li>Geração de relatórios e gráficos financeiros.</li>
                </ul>

                <h5>5. Compartilhamento de Dados</h5>
                <p>Não compartilhamos dados para marketing ou vendas. Usamos serviços de email apenas para notificações e cumprimos obrigações legais.</p>

                <h5>6. Armazenamento e Segurança</h5>
                <p>Dados armazenados em PostgreSQL com acesso restrito; senhas protegidas por hash BCrypt; medidas técnicas e administrativas para segurança.</p>

                <h5>7. Direitos dos Usuários</h5>
                <ul>
                    <li>Acessar seus dados pessoais.</li>
                    <li>Corrigir informações incorretas.</li>
                    <li>Excluir sua conta e dados pelo sistema ou solicitando ao suporte.</li>
                    <li>Saber com quem seus dados são compartilhados.</li>
                    <li>Revogar consentimento (funcionalidades poderão ficar indisponíveis).</li>
                </ul>

                <h5>8. Retenção e Eliminação</h5>
                <p>Dados mantidos enquanto a conta estiver ativa. Após exclusão, perfil fica inativo e, após prazo legal, registros são eliminados.</p>

                <h5>9. Atualizações</h5>
                <p>Estes Termos podem ser alterados a qualquer momento. Notificaremos você no próximo login.</p>

                <h5>Contato</h5>
                <p>Para dúvidas ou solicitações, escreva para <a href="mailto:suporte@cancelei.com">suporte@cancelei.com</a>.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('cep').addEventListener('blur', function () {
        let cep = this.value.replace(/\D/g, '');
        if (cep.length === 8) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        document.getElementById('logradouro').value = data.logradouro || '';
                        document.getElementById('bairro').value = data.bairro || '';
                        document.getElementById('cidade').value = data.localidade || '';
                        document.getElementById('uf').value = data.uf || '';
                    } else {
                        alert("CEP não encontrado.");
                    }
                })
                .catch(() => alert("Erro ao buscar CEP."));
        }
    });
</script>
</body>
</html>
